---
title: 浏览器一帧中发生的事情
date: 2023/10/4
type: frontend
---

首先，在一帧中浏览器会进行页面的重新渲染。浏览器的渲染过程主要包括：

1. **解析**（Parsing）：解析 HTML 构建 DOM 树，解析 CSS 构建 CSSOM。根据 DOM 树和 CSSOM 构建出渲染树。

   解析过程中还涉及到 HTML、CSS、JS 之间的阻塞关系问题：

   - HTML 和 CSS 之间没有阻塞关系，但 CSS 会阻塞 DOM 渲染（就是说 CSS 没解析完成不会进行渲染）。
   - CSS 的下载或解析会阻塞 JS 的执行，因为 JavaScript 经常用于查询元素的 CSS 属性。
   - 如果 script 标签没有 async 或 defer 属性，那么该 JS 资源的下载或解析会阻塞渲染并停止 HTML 和 CSS 的解析。

2. **布局**（Layout）：确定渲染树中每个节点在屏幕上的位置和大小。浏览器计算每个渲染树节点的几何属性，生成布局树。

3. **绘制**（Painting）：绘制阶段将布局树中的节点转换为屏幕上的像素。浏览器遍历布局树时，会根据每个节点的样式信息和几何属性，进行绘制操作，将节点渲染为位图。

4. **合成**（Compositing）：如果页面中有多个图层，浏览器会将这些图层进行合成。将不同图层的位图图像组合在一起，生成最终的页面图像。

6. **显示**（Display）：最后，像素数据被发送给显示设备，显示在用户的屏幕上。

浏览器只会对发生变化的部分进行重新渲染操作，对于某些渲染阶段浏览器也会并行执行，从而提高性能和效率。

其次，浏览器会在这一帧中执行当前事件循环中的任务。所以还会涉及到事件循环。

**引入 Js 事件循环的原因：**

Js 引擎是单线程的，意味着它一次只能执行一个任务。然而，Web 应用中存在大量的异步操作，比如定时器延时器、网络请求等，如果所有这些操作都是同步的，则会导致主线程阻塞，无法响应其他操作，导致页面卡顿。

所以引入事件循环机制，将异步任务添加到相应的队列中，并按照特定的顺序和优先级执行。这种机制允许 Js 引擎在等待异步任务完成的同时，可以先执行其他任务，从而避免了阻塞，提高了并发性。

